<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Time &amp; frequency scans &mdash; NIST Scan Framework For ARTIQ 2.0.0 documentation</title><link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Performing multiple measurements" href="multiple_measurements.html" />
    <link rel="prev" title="Relative scan ranges and auto tracking" href="auto_tracking.html" /> 
<script async type="text/javascript" id="_fed_an_ua_tag" src="https://dap.digitalgov.gov/Universal-Federated-Analytics-Min.js?agency=NIST&subagency=github&pua=UA-66610693-1&yt=true&exts=ppsx,pps,f90,sch,rtf,wrl,txz,m1v,xlsm,msi,xsd,f,tif,eps,mpg,xml,pl,xlt,c">
</script>
  <link rel="stylesheet" href="https://pages.nist.gov/nist-header-footer/css/nist-combined.css">  
  <script src="https://pages.nist.gov/nist-header-footer/js/nist-header-footer.js" type="text/javascript" defer="defer"></script>
  <!--<script type="text/javascript" src="https://pages.nist.gov/leaveNotice/js/jquery.leaveNotice-nist.min.js"></script>-->
  <link rel="stylesheet" type="text/css" href="https://pages.nist.gov/leaveNotice/css/jquery.leaveNotice.css" />  
  <script type="text/javascript">
	  function link_is_external(link_element) {
	      return (link_element.host !== window.location.host);
	  }
	  (function ($) {
	      $.fn.leaveNotice = function (opt) {
	          var defaults = {
	              siteName: "NIST",
	              exitMessage:
	                  "<h2><strong>Thank you for visiting {SITENAME}.</strong></h2><p>We hope your visit was informative.</p><p>We have provided this link to a non-NIST site because it has information that may be of interest to our users. NIST does not necessarily endorse the views expressed or the facts presented on this site. Further, NIST does not endorse any commercial products that may be advertised or available on this site.</p>",
	              preLinkMessage: "<div class='setoff'><p>You will now be directed to:<br/>{URL}</p></div>",
	              linkString: "",
	              newWindow: false,
	              timeOut: 1e4,
	              overlayId: "ln-blackout",
	              messageBoxId: "ln-messageBox",
	              messageHolderId: "ln-messageHolder",
	              linkId: "ln-link",
	              displayUrlLength: 50,
	              overlayAlpha: 0.3,
	          };
	          var options = $.extend(defaults, opt);
	          return this.each(function () {
				  if(link_is_external(this)) {
		              el = $(this);
					  $(this).unbind();
		              var url = el.attr("href");
		              var ulen = options.displayUrlLength;
		              if (url.length >= ulen) {
		                  var suffix = "...";
		              } else {
		                  var suffix = "";
		              }
		              var shortUrl = url.substr(0, ulen) + suffix;
		              var title = el.attr("title");
		              if (title === undefined || title == "") {
		                  var linkText = shortUrl;
		              } else {
		                  var linkText = title;
		              }
		              options.timeOut = options.newWindow ? 0 : options.timeOut;
		              el.click(function (event) {
						  event.preventDefault();
		                  $("body").append('<div id="' + options.overlayId + '"></div>');
		                  $("body").append('<div id="' + options.messageHolderId + '"><div id="' + options.messageBoxId + '"></div></div>');
		                  if (options.overlayAlpha !== false) {
		                      $("#" + options.overlayId).css("opacity", options.overlayAlpha);
		                  }
		                  preFilteredContent = options.exitMessage + options.preLinkMessage;
		                  msgContent = preFilteredContent.replace(/\{URL\}/g, '<a id="' + options.linkId + '" href="' + url + '" title="' + url + '"' + options.linkString + ">" + linkText + "</a>");
		                  msgContent = msgContent.replace(/\{SITENAME\}/g, options.siteName);
		                  if (options.timeOut > 0) {
		                      msgContent += '<p id="ln-cancelMessage"><a href="#close" id="ln-cancelLink">Cancel</a> or press the ESC key.</p>';
		                  } else {
		                      msgContent += '<p id="ln-cancelMessage">Click the link above to continue or <a href="#close" id="ln-cancelLink">Cancel</a></p>';
		                  }
		                  $("#" + options.messageBoxId).append(msgContent);
		                  if (options.timeOut > 0) {
		                      leaveIn = setTimeout(function () {
		                          $("#ln-cancelMessage").html("<em>Loading...</em>");
		                          window.location.href = url;
		                      }, options.timeOut);
		                  } else {
		                      leaveIn = false;
		                  }
		                  if (options.newWindow) {
		                      $("a#" + options.linkId)
		                          .attr("target", "_blank")
		                          .click(function () {
		                              closeDialog(options, leaveIn);
		                          });
		                  }
		                  $("#ln-cancelLink").click(function () {
		                      closeDialog(options, leaveIn);
		                      return false;
		                  });
		                  $(document).bind("keyup", function (e) {
		                      if (e.which == 27) {
		                          closeDialog(options, leaveIn);
		                      }
		                  });
		                  $(window).unload(function () {
		                      closeDialog(options, leaveIn);
		                  });
		                  return false;
		              });
				  }
	          });
	      };
	      function closeDialog(options, timer) {
	          if (options.timeOut > 0) {
	              clearTimeout(timer);
	          }
	          $("#" + options.overlayId + ", #" + options.messageHolderId).fadeOut("fast", function () {
	              $("#" + options.overlayId + ", #" + options.messageHolderId).remove();
	          });
	          $(document).unbind("keyup");
	      }
	  })(jQuery);
	  
  	$(function(){
  	  $('a').leaveNotice();
  	});
  </script>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> NIST Scan Framework For ARTIQ
          </a>
              <div class="version">
                2.0.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installing.html">Installing the NIST scan framework</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../scans.html">Creating scan experiments</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="getting_started.html">Getting Started with Scans</a></li>
<li class="toctree-l2"><a class="reference internal" href="statistics.html">Processing and handling of scan data</a></li>
<li class="toctree-l2"><a class="reference internal" href="core_features.html">Core scan features</a></li>
<li class="toctree-l2"><a class="reference internal" href="auto_tracking.html">Relative scan ranges and auto tracking</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Time &amp; frequency scans</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#time-scans">Time scans</a></li>
<li class="toctree-l3"><a class="reference internal" href="#frequency-scans">Frequency scans</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id1">Time/frequency scans</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="multiple_measurements.html">Performing multiple measurements</a></li>
<li class="toctree-l2"><a class="reference internal" href="calculations.html">Performing calculations</a></li>
<li class="toctree-l2"><a class="reference internal" href="warmup_points.html">Running warmup points</a></li>
<li class="toctree-l2"><a class="reference internal" href="monitor_histograms.html">Monitor histograms</a></li>
<li class="toctree-l2"><a class="reference internal" href="2d_scans.html">2D Scans</a></li>
<li class="toctree-l2"><a class="reference internal" href="lost_ion.html">Lost ion detection and reloading</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../models.html">Using models for data processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scans_ref.html">Scans references and API docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../models_ref.html">Models reference and API docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../analysis.html">Curve fitting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../applets.html">Applets</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">NIST Scan Framework For ARTIQ</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../scans.html">Creating scan experiments</a> &raquo;</li>
      <li>Time &amp; frequency scans</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/scans/time_freq_scans.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="time-frequency-scans">
<h1>Time &amp; frequency scans<a class="headerlink" href="#time-frequency-scans" title="Permalink to this headline">¶</a></h1>
<p>Scans over a range of time values or frequency values are common.  To simplify the process of writing these
types of scans, the scan framework provides three base classes from which a scan may inherit.  These
base classes are <a class="reference internal" href="api.html#scan_framework.scans.extensions.TimeScan" title="scan_framework.scans.extensions.TimeScan"><code class="xref py py-class docutils literal notranslate"><span class="pre">TimeScan</span></code></a>,
<a class="reference internal" href="api.html#scan_framework.scans.extensions.FreqScan" title="scan_framework.scans.extensions.FreqScan"><code class="xref py py-class docutils literal notranslate"><span class="pre">FreqScan</span></code></a>, and
<a class="reference internal" href="api.html#scan_framework.scans.extensions.TimeFreqScan" title="scan_framework.scans.extensions.TimeFreqScan"><code class="xref py py-class docutils literal notranslate"><span class="pre">TimeFreqScan</span></code></a>.  Additionally, any of these scans
can also use auto-tracking or set <code class="code docutils literal notranslate"><span class="pre">self._x_offset</span></code> to offset the scan points.  See <a class="reference internal" href="auto_tracking.html#auto-tracking"><span class="std std-ref">Relative scan ranges and auto tracking</span></a>.</p>
<div class="section" id="time-scans">
<h2>Time scans<a class="headerlink" href="#time-scans" title="Permalink to this headline">¶</a></h2>
<p>Time scans create a configurable GUI argument for entering a range of times to scan over.  To create a time
scan, simply inherit from the <a class="reference internal" href="api.html#scan_framework.scans.extensions.TimeScan" title="scan_framework.scans.extensions.TimeScan"><code class="xref py py-class docutils literal notranslate"><span class="pre">TimeScan</span></code></a> class and call
<a class="reference internal" href="api.html#scan_framework.scans.scan.Scan.scan_arguments" title="scan_framework.scans.scan.Scan.scan_arguments"><code class="xref py py-meth docutils literal notranslate"><span class="pre">scan_arguments()</span></code></a> in <code class="code docutils literal notranslate"><span class="pre">build()</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scan_framework.scans</span> <span class="kn">import</span> <span class="o">*</span>


<span class="k">class</span> <span class="nc">MyTimeScan</span><span class="p">(</span><span class="n">Scan1D</span><span class="p">,</span> <span class="n">TimeScan</span><span class="p">,</span> <span class="n">EnvExperiment</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="o">...</span>
        <span class="c1"># scan_arguments() creates an additional GUI argument for entering a time range</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scan_arguments</span><span class="p">(</span>
            <span class="c1"># the GUI argument can be fully configured via the &#39;times&#39; argument</span>
            <span class="n">times</span><span class="o">=</span><span class="p">{</span>
                <span class="s1">&#39;start&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
                <span class="s1">&#39;stop&#39;</span><span class="p">:</span><span class="mi">100</span><span class="o">*</span><span class="n">us</span><span class="p">,</span>
                <span class="s1">&#39;npoints&#39;</span><span class="p">:</span><span class="mi">50</span><span class="p">,</span>
                <span class="s1">&#39;unit&#39;</span><span class="p">:</span> <span class="s1">&#39;us&#39;</span><span class="p">,</span>
                <span class="s1">&#39;scale&#39;</span><span class="p">:</span> <span class="n">us</span><span class="p">,</span>
                <span class="s1">&#39;global_step&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="o">*</span><span class="n">us</span><span class="p">,</span>
                <span class="s1">&#39;ndecimals&#39;</span><span class="p">:</span> <span class="mi">0</span>
            <span class="p">}</span>
        <span class="p">)</span>
</pre></div>
</div>
<p>When creating a time scan it is not necessary to define the <a class="reference internal" href="api.html#scan_framework.scans.scan.Scan.get_scan_points" title="scan_framework.scans.scan.Scan.get_scan_points"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_scan_points()</span></code></a>
callback method;  the framework will automatically scan over the GUI argument named ‘times’.</p>
<p>The scan model that is registered with a time scan can also inherit from the
<a class="reference internal" href="../models/api.html#scan_framework.models.time_model.TimeModel" title="scan_framework.models.time_model.TimeModel"><code class="xref py py-class docutils literal notranslate"><span class="pre">TimeModel</span></code></a> class which automatically
sets the <a class="reference internal" href="../models/settings.html#scan_framework.models.scan_model.ScanModel.x_units" title="scan_framework.models.scan_model.ScanModel.x_units"><code class="xref py py-attr docutils literal notranslate"><span class="pre">x_units</span></code></a> and
<a class="reference internal" href="../models/settings.html#scan_framework.models.scan_model.ScanModel.x_label" title="scan_framework.models.scan_model.ScanModel.x_label"><code class="xref py py-attr docutils literal notranslate"><span class="pre">x_label</span></code></a>
attributes of the scan model.</p>
</div>
<div class="section" id="frequency-scans">
<h2>Frequency scans<a class="headerlink" href="#frequency-scans" title="Permalink to this headline">¶</a></h2>
<p>Frequency scans create a configurable GUI argument for entering a range of frequencies to scan over.  To create a
frequency scan, simply inherit from the <a class="reference internal" href="api.html#scan_framework.scans.extensions.FreqScan" title="scan_framework.scans.extensions.FreqScan"><code class="xref py py-class docutils literal notranslate"><span class="pre">FreqScan</span></code></a> class and call
<a class="reference internal" href="api.html#scan_framework.scans.scan.Scan.scan_arguments" title="scan_framework.scans.scan.Scan.scan_arguments"><code class="xref py py-meth docutils literal notranslate"><span class="pre">scan_arguments()</span></code></a> in <code class="code docutils literal notranslate"><span class="pre">build()</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scan_framework.scans</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">scan_framework.models</span> <span class="kn">import</span> <span class="o">*</span>


<span class="k">class</span> <span class="nc">MyFreqScan</span><span class="p">(</span><span class="n">Scan1D</span><span class="p">,</span> <span class="n">FreqScan</span><span class="p">,</span> <span class="n">EnvExperiment</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>

        <span class="c1"># scan_arguments() creates an additional GUI argument for entering a frequency range</span>
        <span class="c1"># the range of frequencies is set to the attribute named &#39;frequencies&#39; (i.e. self.frequencies)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scan_arguments</span><span class="p">(</span>
            <span class="c1"># the GUI argument can be fully configured via the &#39;frequencies&#39; argument</span>
            <span class="n">frequencies</span><span class="o">=</span><span class="p">{</span>
                <span class="s1">&#39;start&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.1</span> <span class="o">*</span> <span class="n">MHz</span><span class="p">,</span>
                <span class="s1">&#39;stop&#39;</span><span class="p">:</span>  <span class="mf">0.1</span> <span class="o">*</span> <span class="n">MHz</span><span class="p">,</span>
                <span class="s1">&#39;npoints&#39;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>
                <span class="s1">&#39;unit&#39;</span><span class="p">:</span> <span class="s1">&#39;MHz&#39;</span><span class="p">,</span>
                <span class="s1">&#39;scale&#39;</span><span class="p">:</span> <span class="n">MHz</span><span class="p">,</span>
                <span class="s1">&#39;global_step&#39;</span><span class="p">:</span> <span class="mf">0.1</span><span class="o">*</span><span class="n">MHz</span><span class="p">,</span>
                <span class="s1">&#39;ndecimals&#39;</span><span class="p">:</span> <span class="mi">1</span>
            <span class="p">}</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">prepare</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># -- like all scans, frequency scans can also use auto-tracking to center a relative scan</span>
        <span class="c1"># range about a fixed frequency</span>

        <span class="c1"># Create a default fitted frequency for the first run when no fits have been performed yet</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_dataset</span><span class="p">(</span><span class="s1">&#39;example.defaults.frequency&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="o">*</span><span class="n">MHz</span><span class="p">,</span> <span class="n">broadcast</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">ScanModel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                          <span class="n">namespace</span><span class="o">=</span><span class="s1">&#39;example&#39;</span><span class="p">,</span>
                          <span class="n">main_fit</span><span class="o">=</span><span class="s1">&#39;frequency&#39;</span><span class="p">,</span>
                          <span class="c1"># tell framework to use default value above when no fit exists</span>
                          <span class="n">default_fallback</span><span class="o">=</span><span class="kc">True</span>
                          <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">register_model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">auto_track</span><span class="o">=</span><span class="s1">&#39;fit&#39;</span><span class="p">,</span> <span class="n">measurement</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>When creating a frequency scan it is not necessary to define the <a class="reference internal" href="api.html#scan_framework.scans.scan.Scan.get_scan_points" title="scan_framework.scans.scan.Scan.get_scan_points"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_scan_points()</span></code></a>
callback method;  the framework will automatically scan over the GUI frequencies argument.</p>
<p>The scan model that is registered with a frequency scan can also inherit from the
<a class="reference internal" href="../models/api.html#scan_framework.models.freq_model.FreqModel" title="scan_framework.models.freq_model.FreqModel"><code class="xref py py-class docutils literal notranslate"><span class="pre">FreqModel</span></code></a> class which automatically
sets the <a class="reference internal" href="../models/settings.html#scan_framework.models.scan_model.ScanModel.x_units" title="scan_framework.models.scan_model.ScanModel.x_units"><code class="xref py py-attr docutils literal notranslate"><span class="pre">x_units</span></code></a> and
<a class="reference internal" href="../models/settings.html#scan_framework.models.scan_model.ScanModel.x_label" title="scan_framework.models.scan_model.ScanModel.x_label"><code class="xref py py-attr docutils literal notranslate"><span class="pre">x_label</span></code></a>
attributes of the scan model.</p>
</div>
<div class="section" id="id1">
<h2>Time/frequency scans<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>Time/frequency scans are provided for scans that need to scan over either a range of frequencies or
a range of times.  This is useful for scans of atomic transitions which need to find both the transition
frequency and the appropriate pi time for the transition.  Creating a <a class="reference internal" href="api.html#scan_framework.scans.extensions.TimeFreqScan" title="scan_framework.scans.extensions.TimeFreqScan"><code class="xref py py-class docutils literal notranslate"><span class="pre">TimeFreqScan</span></code></a>
significantly simplifies these types of scans.  Inheriting from
<a class="reference internal" href="api.html#scan_framework.scans.extensions.TimeFreqScan" title="scan_framework.scans.extensions.TimeFreqScan"><code class="xref py py-class docutils literal notranslate"><span class="pre">TimeFreqScan</span></code></a></p>
<blockquote>
<div><ol class="arabic simple">
<li><p>Creates two GUI arguments for entering either a range of frequencies or a range of times.</p></li>
<li><p>Creates a GUI argument for specifying if the scan should scan over the range of frequencies or times.</p></li>
<li><p>Centers the frequency range about the last fitted frequency when auto-tracking is used.</p></li>
<li><p>Determines the scan points automatically (<code class="code docutils literal notranslate"><span class="pre">get_scan_points()</span></code> does not need to be implemented).</p></li>
<li><p>Uses the last fitted pi time for frequency scans when using auto-tracking.</p></li>
<li><p>Uses the last fitted frequency for time scans when using auto-tracking.</p></li>
<li><p>Provides a GUI argument to enter the pulse time for frequency scans when auto-tracking is not being used.</p></li>
<li><p>Provides a GUI argument to enter the frequency for time scans when auto-tracking is not being used.</p></li>
<li><p>Passes both the frequency and time as arguments to the <code class="code docutils literal notranslate"><span class="pre">measure()</span></code> method.</p></li>
</ol>
</div></blockquote>
<p>To create a Time/frequency scan, simply inherit from the
<a class="reference internal" href="api.html#scan_framework.scans.extensions.TimeFreqScan" title="scan_framework.scans.extensions.TimeFreqScan"><code class="xref py py-class docutils literal notranslate"><span class="pre">TimeFreqScan</span></code></a> class and call
<a class="reference internal" href="api.html#scan_framework.scans.scan.Scan.scan_arguments" title="scan_framework.scans.scan.Scan.scan_arguments"><code class="xref py py-meth docutils literal notranslate"><span class="pre">scan_arguments()</span></code></a> in <code class="code docutils literal notranslate"><span class="pre">build()</span></code>.  If you are also
using auto-tracking, register a single auto-tracking scan model and use the
<a class="reference internal" href="../models/api.html#scan_framework.models.scan_model.ScanModel.type" title="scan_framework.models.scan_model.ScanModel.type"><code class="xref py py-attr docutils literal notranslate"><span class="pre">type</span></code></a> attribute in the scan model to dynamically
determine the fit function, main fit, etc based on the type (frequency or time) of scan being performed.
For a full example of a <a class="reference internal" href="api.html#scan_framework.scans.extensions.TimeFreqScan" title="scan_framework.scans.extensions.TimeFreqScan"><code class="xref py py-class docutils literal notranslate"><span class="pre">TimeFreqScan</span></code></a> class that uses
auto-tracking, see the example below.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The scan model that is registered for a time/frequency scan can also inherit from the
<a class="reference internal" href="../models/api.html#scan_framework.models.time_freq_model.TimeFreqModel" title="scan_framework.models.time_freq_model.TimeFreqModel"><code class="xref py py-class docutils literal notranslate"><span class="pre">TimeFreqModel</span></code></a> class which automatically
sets the <a class="reference internal" href="../models/settings.html#scan_framework.models.scan_model.ScanModel.x_units" title="scan_framework.models.scan_model.ScanModel.x_units"><code class="xref py py-attr docutils literal notranslate"><span class="pre">x_units</span></code></a> and
<a class="reference internal" href="../models/settings.html#scan_framework.models.scan_model.ScanModel.x_label" title="scan_framework.models.scan_model.ScanModel.x_label"><code class="xref py py-attr docutils literal notranslate"><span class="pre">x_label</span></code></a>
attributes of the scan model.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Scan models can also be registered with the <code class="code docutils literal notranslate"><span class="pre">bind</span></code> argument set to True in time/frequency scans.
i.e. <code class="code docutils literal notranslate"><span class="pre">self.register_model(my_model_instance,</span> <span class="pre">bind=True)</span></code>.  This will cause the model to be
re-bound after its <code class="code docutils literal notranslate"><span class="pre">type</span></code> attribute is set to the current scan type (time or frequency).  This
is useful if you need to create a dynamic namespace that includes a token for the type of scan.
e.g. <code class="code docutils literal notranslate"><span class="pre">namespace</span> <span class="pre">=</span> <span class="pre">'microwaves.%type'</span></code>.  <code class="code docutils literal notranslate"><span class="pre">%type</span></code> will be replaced by either ‘frequency’ or ‘time’ when
the model is registered with <code class="code docutils literal notranslate"><span class="pre">bind=True</span></code>.</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scan_framework.scans</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">scan_framework.models</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">scan_framework.analysis.curvefits</span> <span class="kn">import</span> <span class="n">AtomLine</span><span class="p">,</span> <span class="n">Sine</span>
<span class="kn">import</span> <span class="nn">random</span>


<span class="k">class</span> <span class="nc">MicrowaveScan</span><span class="p">(</span><span class="n">Scan1D</span><span class="p">,</span> <span class="n">TimeFreqScan</span><span class="p">,</span> <span class="n">EnvExperiment</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Microwave scan</span>

<span class="sd">    Scans frequencies and pulse times of microwave transitions</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># The atomic transition, identified by an integer to simply logic in</span>
        <span class="c1"># the &quot;measure()&quot; method</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setattr_argument</span><span class="p">(</span><span class="s1">&#39;transition&#39;</span><span class="p">,</span> <span class="n">EnumerationValue</span><span class="p">(</span>
            <span class="p">[</span><span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">,</span> <span class="s1">&#39;3&#39;</span><span class="p">,</span> <span class="s1">&#39;4&#39;</span><span class="p">,</span> <span class="s1">&#39;5&#39;</span><span class="p">,</span> <span class="s1">&#39;6&#39;</span><span class="p">,</span> <span class="s1">&#39;7&#39;</span><span class="p">],</span>
            <span class="n">default</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="p">))</span>

        <span class="c1"># scan settings, scan ranges, etc.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scan_arguments</span><span class="p">(</span>
            <span class="c1"># frequency range can be customized</span>
            <span class="n">frequencies</span><span class="o">=</span><span class="p">{</span>
                <span class="s1">&#39;start&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.3</span><span class="o">*</span><span class="n">MHz</span><span class="p">,</span>
                <span class="s1">&#39;stop&#39;</span><span class="p">:</span> <span class="mf">0.3</span><span class="o">*</span><span class="n">MHz</span>
            <span class="p">},</span>
            <span class="c1"># time range can also be customized</span>
            <span class="n">times</span><span class="o">=</span><span class="p">{</span>
                <span class="s1">&#39;start&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="o">*</span><span class="n">us</span><span class="p">,</span>
                <span class="s1">&#39;stop&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="o">*</span><span class="n">us</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="c1"># create devices, instantiate libs, etc.</span>
        <span class="o">...</span>

    <span class="k">def</span> <span class="nf">prepare</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># convert string transition to integer for the &quot;measure()&quot; method</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transition</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transition</span><span class="p">)</span>

        <span class="c1"># create and register the scan model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">MicrowavesScanModel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
             <span class="c1"># set the model&#39;s transition attribute to the selected transition in the GUI.</span>
             <span class="c1"># this allows the %transition token in the model namespace to be replaced</span>
             <span class="c1"># by the current transition.</span>
             <span class="n">transition</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">transition</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">register_model</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span>
                            <span class="c1"># calculate statistics and store all data to the datasets</span>
                            <span class="n">measurement</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                            <span class="c1"># perform a final fit to the data</span>
                            <span class="n">fit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                            <span class="c1"># points will be offset by this model&#39;s last fitted frequency value</span>
                            <span class="c1"># (a.k.a. it&#39;s main fit)</span>
                            <span class="n">auto_track</span><span class="o">=</span><span class="s1">&#39;fit&#39;</span><span class="p">)</span>

    <span class="nd">@kernel</span>
    <span class="k">def</span> <span class="nf">initialize_devices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>

    <span class="nd">@kernel</span>
    <span class="k">def</span> <span class="nf">measure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">frequency</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cooling</span><span class="o">.</span><span class="n">doppler</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">transition</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">microwaves</span><span class="o">.</span><span class="n">transition_1</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">transition</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">microwaves</span><span class="o">.</span><span class="n">transition_2</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">transition</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">microwaves</span><span class="o">.</span><span class="n">transition_3</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">transition</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">microwaves</span><span class="o">.</span><span class="n">transition_4</span><span class="p">()</span>

        <span class="c1"># pulse dds</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">microwaves</span><span class="o">.</span><span class="n">set_frequency</span><span class="p">(</span><span class="n">frequency</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">microwaves</span><span class="o">.</span><span class="n">pulse</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>

        <span class="c1"># detect</span>
        <span class="n">counts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">detection</span><span class="o">.</span><span class="n">detect</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">counts</span>


<span class="k">class</span> <span class="nc">MicrowavesScanModel</span><span class="p">(</span><span class="n">TimeFreqModel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Microwave scan model</span>

<span class="sd">    Processes data from microwave scans</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># %transition will be replaced by the transition selected in the GUI</span>
    <span class="n">namespace</span> <span class="o">=</span> <span class="s1">&#39;microwaves.%transition&#39;</span>
    <span class="n">y_label</span> <span class="o">=</span> <span class="s1">&#39;Counts&#39;</span>

    <span class="c1"># scales for formatting fit params printed to the log window</span>
    <span class="n">scales</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;f&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;scale&#39;</span><span class="p">:</span> <span class="n">MHz</span><span class="p">,</span>
            <span class="s1">&#39;unit&#39;</span><span class="p">:</span> <span class="s1">&#39;MHz&#39;</span>
        <span class="p">},</span>
        <span class="s1">&#39;phi&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;scale&#39;</span><span class="p">:</span> <span class="mf">3.14159</span><span class="p">,</span>
            <span class="s1">&#39;unit&#39;</span><span class="p">:</span> <span class="s1">&#39;pi&#39;</span>
        <span class="p">},</span>
        <span class="s1">&#39;f0&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;scale&#39;</span><span class="p">:</span> <span class="n">MHz</span><span class="p">,</span>
            <span class="s1">&#39;unit&#39;</span><span class="p">:</span> <span class="s1">&#39;MHz&#39;</span>
        <span class="p">},</span>
        <span class="s1">&#39;Omega0&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;scale&#39;</span><span class="p">:</span> <span class="n">MHz</span><span class="p">,</span>
            <span class="s1">&#39;unit&#39;</span><span class="p">:</span> <span class="s1">&#39;MHz&#39;</span>
        <span class="p">},</span>
        <span class="s1">&#39;T&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;scale&#39;</span><span class="p">:</span> <span class="n">us</span><span class="p">,</span>
            <span class="s1">&#39;unit&#39;</span><span class="p">:</span> <span class="s1">&#39;us&#39;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">main_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;frequency&#39;</span><span class="p">:</span>
            <span class="c1"># save fit param &#39;f0&#39; to dataset named &#39;frequency&#39;</span>
            <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;f0&#39;</span><span class="p">,</span> <span class="s1">&#39;frequency&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;time&#39;</span><span class="p">:</span>
            <span class="c1"># save calculated fit param &#39;pi_time&#39;</span>
            <span class="k">return</span> <span class="s1">&#39;pi_time&#39;</span>

    <span class="k">def</span> <span class="nf">before_validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fit</span><span class="p">):</span>
        <span class="c1"># calculate the fit param &#39;pi_time&#39; from the fit param &#39;f&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;time&#39;</span><span class="p">:</span>
            <span class="n">fit</span><span class="o">.</span><span class="n">fitresults</span><span class="p">[</span><span class="s1">&#39;pi_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">fit</span><span class="o">.</span><span class="n">fitresults</span><span class="p">[</span><span class="s1">&#39;f&#39;</span><span class="p">])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">fit_function</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;frequency&#39;</span><span class="p">:</span>
            <span class="c1"># frequency scans use the AtomLine fit function</span>
            <span class="k">return</span> <span class="n">AtomLine</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;time&#39;</span><span class="p">:</span>
            <span class="c1"># times scans use the Sine fit function</span>
            <span class="k">return</span> <span class="n">Sine</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Unknown scan type </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">man_scale</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># fit parameter scales, used by analysis.curvefits while fitting</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;frequency&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s1">&#39;Omega0&#39;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">10</span> <span class="o">*</span> <span class="n">us</span><span class="p">),</span>
                <span class="s1">&#39;T&#39;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">us</span><span class="p">,</span>
                <span class="s1">&#39;f0&#39;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">GHz</span><span class="p">,</span>
                <span class="s1">&#39;y0&#39;</span><span class="p">:</span> <span class="mi">1</span>
            <span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
                <span class="s1">&#39;f&#39;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">10</span> <span class="o">*</span> <span class="n">us</span><span class="p">),</span>
                <span class="s1">&#39;phi&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s1">&#39;y0&#39;</span><span class="p">:</span> <span class="mi">1</span>
            <span class="p">}</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">guess</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># fit parameter guesses, used by analysis.curvefits while fitting</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;time&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">transition</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">]:</span>
                <span class="k">return</span> <span class="p">{</span>
                    <span class="s1">&#39;phi&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="o">*</span><span class="mf">3.14159</span><span class="p">,</span>
                    <span class="s1">&#39;y0&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
                    <span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">{</span>
                    <span class="s1">&#39;phi&#39;</span><span class="p">:</span> <span class="mf">1.5</span><span class="o">*</span><span class="mf">3.14159</span><span class="p">,</span>
                    <span class="s1">&#39;y0&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
                    <span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
                <span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s1">&#39;T&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;pi_time&#39;</span><span class="p">,</span> <span class="n">archive</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="p">}</span>
</pre></div>
</div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="auto_tracking.html" class="btn btn-neutral float-left" title="Relative scan ranges and auto tracking" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="multiple_measurements.html" class="btn btn-neutral float-right" title="Performing multiple measurements" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright .</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>