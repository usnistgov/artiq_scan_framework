<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Relative scan ranges and auto tracking &mdash; NIST Scan Framework For ARTIQ 2.1.0 documentation</title><link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Time &amp; frequency scans" href="time_freq_scans.html" />
    <link rel="prev" title="Core scan features" href="core_features.html" /> 
<script async type="text/javascript" id="_fed_an_ua_tag" src="https://dap.digitalgov.gov/Universal-Federated-Analytics-Min.js?agency=NIST&subagency=github&pua=UA-66610693-1&yt=true&exts=ppsx,pps,f90,sch,rtf,wrl,txz,m1v,xlsm,msi,xsd,f,tif,eps,mpg,xml,pl,xlt,c">
</script>
  <link rel="stylesheet" href="https://pages.nist.gov/nist-header-footer/css/nist-combined.css">  
  <script src="https://pages.nist.gov/nist-header-footer/js/nist-header-footer.js" type="text/javascript" defer="defer"></script>
  <!--<script type="text/javascript" src="https://pages.nist.gov/leaveNotice/js/jquery.leaveNotice-nist.min.js"></script>-->
  <link rel="stylesheet" type="text/css" href="https://pages.nist.gov/leaveNotice/css/jquery.leaveNotice.css" />  
  <script type="text/javascript">
	  function link_is_external(link_element) {
	      return (link_element.host !== window.location.host);
	  }
	  (function ($) {
	      $.fn.leaveNotice = function (opt) {
	          var defaults = {
	              siteName: "NIST",
	              exitMessage:
	                  "<h2><strong>Thank you for visiting {SITENAME}.</strong></h2><p>We hope your visit was informative.</p><p>We have provided this link to a non-NIST site because it has information that may be of interest to our users. NIST does not necessarily endorse the views expressed or the facts presented on this site. Further, NIST does not endorse any commercial products that may be advertised or available on this site.</p>",
	              preLinkMessage: "<div class='setoff'><p>You will now be directed to:<br/>{URL}</p></div>",
	              linkString: "",
	              newWindow: false,
	              timeOut: 1e4,
	              overlayId: "ln-blackout",
	              messageBoxId: "ln-messageBox",
	              messageHolderId: "ln-messageHolder",
	              linkId: "ln-link",
	              displayUrlLength: 50,
	              overlayAlpha: 0.3,
	          };
	          var options = $.extend(defaults, opt);
	          return this.each(function () {
				  if(link_is_external(this)) {
		              el = $(this);
					  $(this).unbind();
		              var url = el.attr("href");
		              var ulen = options.displayUrlLength;
		              if (url.length >= ulen) {
		                  var suffix = "...";
		              } else {
		                  var suffix = "";
		              }
		              var shortUrl = url.substr(0, ulen) + suffix;
		              var title = el.attr("title");
		              if (title === undefined || title == "") {
		                  var linkText = shortUrl;
		              } else {
		                  var linkText = title;
		              }
		              options.timeOut = options.newWindow ? 0 : options.timeOut;
		              el.click(function (event) {
						  event.preventDefault();
		                  $("body").append('<div id="' + options.overlayId + '"></div>');
		                  $("body").append('<div id="' + options.messageHolderId + '"><div id="' + options.messageBoxId + '"></div></div>');
		                  if (options.overlayAlpha !== false) {
		                      $("#" + options.overlayId).css("opacity", options.overlayAlpha);
		                  }
		                  preFilteredContent = options.exitMessage + options.preLinkMessage;
		                  msgContent = preFilteredContent.replace(/\{URL\}/g, '<a id="' + options.linkId + '" href="' + url + '" title="' + url + '"' + options.linkString + ">" + linkText + "</a>");
		                  msgContent = msgContent.replace(/\{SITENAME\}/g, options.siteName);
		                  if (options.timeOut > 0) {
		                      msgContent += '<p id="ln-cancelMessage"><a href="#close" id="ln-cancelLink">Cancel</a> or press the ESC key.</p>';
		                  } else {
		                      msgContent += '<p id="ln-cancelMessage">Click the link above to continue or <a href="#close" id="ln-cancelLink">Cancel</a></p>';
		                  }
		                  $("#" + options.messageBoxId).append(msgContent);
		                  if (options.timeOut > 0) {
		                      leaveIn = setTimeout(function () {
		                          $("#ln-cancelMessage").html("<em>Loading...</em>");
		                          window.location.href = url;
		                      }, options.timeOut);
		                  } else {
		                      leaveIn = false;
		                  }
		                  if (options.newWindow) {
		                      $("a#" + options.linkId)
		                          .attr("target", "_blank")
		                          .click(function () {
		                              closeDialog(options, leaveIn);
		                          });
		                  }
		                  $("#ln-cancelLink").click(function () {
		                      closeDialog(options, leaveIn);
		                      return false;
		                  });
		                  $(document).bind("keyup", function (e) {
		                      if (e.which == 27) {
		                          closeDialog(options, leaveIn);
		                      }
		                  });
		                  $(window).unload(function () {
		                      closeDialog(options, leaveIn);
		                  });
		                  return false;
		              });
				  }
	          });
	      };
	      function closeDialog(options, timer) {
	          if (options.timeOut > 0) {
	              clearTimeout(timer);
	          }
	          $("#" + options.overlayId + ", #" + options.messageHolderId).fadeOut("fast", function () {
	              $("#" + options.overlayId + ", #" + options.messageHolderId).remove();
	          });
	          $(document).unbind("keyup");
	      }
	  })(jQuery);
	  
  	$(function(){
  	  $('a').leaveNotice();
  	});
  </script>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> NIST Scan Framework For ARTIQ
          </a>
              <div class="version">
                2.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installing.html">Installing the NIST scan framework</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../scans.html">Creating scan experiments</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="getting_started.html">Getting Started with Scans</a></li>
<li class="toctree-l2"><a class="reference internal" href="statistics.html">Processing and handling of scan data</a></li>
<li class="toctree-l2"><a class="reference internal" href="core_features.html">Core scan features</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Relative scan ranges and auto tracking</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#relative-scan-ranges">Relative scan ranges</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id1">Auto-tracking</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="time_freq_scans.html">Time &amp; frequency scans</a></li>
<li class="toctree-l2"><a class="reference internal" href="multiple_measurements.html">Performing multiple measurements</a></li>
<li class="toctree-l2"><a class="reference internal" href="calculations.html">Performing calculations</a></li>
<li class="toctree-l2"><a class="reference internal" href="warmup_points.html">Running warmup points</a></li>
<li class="toctree-l2"><a class="reference internal" href="monitor_histograms.html">Monitor histograms</a></li>
<li class="toctree-l2"><a class="reference internal" href="2d_scans.html">2D Scans</a></li>
<li class="toctree-l2"><a class="reference internal" href="lost_ion.html">Lost ion detection and reloading</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../models.html">Using models for data processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scans_ref.html">Scans references and API docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../models_ref.html">Models reference and API docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../analysis.html">Curve fitting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../applets.html">Applets</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">NIST Scan Framework For ARTIQ</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../scans.html">Creating scan experiments</a> &raquo;</li>
      <li>Relative scan ranges and auto tracking</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/scans/auto_tracking.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="relative-scan-ranges-and-auto-tracking">
<span id="auto-tracking"></span><h1>Relative scan ranges and auto tracking<a class="headerlink" href="#relative-scan-ranges-and-auto-tracking" title="Permalink to this headline">¶</a></h1>
<div class="section" id="relative-scan-ranges">
<h2>Relative scan ranges<a class="headerlink" href="#relative-scan-ranges" title="Permalink to this headline">¶</a></h2>
<p>Often it is desirable to specify a range of scan points that is relative to some fixed offset.  For example,
scans of atomic resonances vs probe frequencies are often most useful when the probe frequency range is
specified as a range of frequencies relative to some fixed atomic frequency.  A scan range that is much smaller
than the fixed frequency can then easily be entered in the dashboard without having to keep track
of which digit in a large number corresponds to a certain scale (e.g. MHz or KHz portions of a GHz value).</p>
<p>This is easily accomplished by setting <code class="code docutils literal notranslate"><span class="pre">self._x_offset</span></code> in the scan class.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="o">...</span>

    <span class="c1"># range of frequencies relative to 1.8121*GHz</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">setattr_argument</span><span class="p">(</span><span class="s1">&#39;frequencies&#39;</span><span class="p">,</span> <span class="n">Scannable</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="n">RangeScan</span><span class="p">(</span>
            <span class="n">start</span><span class="o">=-</span><span class="mf">0.1</span><span class="o">*</span><span class="n">MHz</span><span class="p">,</span>
            <span class="n">stop</span><span class="o">=</span><span class="mf">0.1</span><span class="o">*</span><span class="n">MHz</span><span class="p">,</span>
            <span class="n">npoints</span><span class="o">=</span><span class="mi">50</span>
        <span class="p">),</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;MHz&#39;</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">MHz</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">prepare</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c1"># offset all scan points by this value</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_x_offset</span> <span class="o">=</span> <span class="mf">1.8121</span><span class="o">*</span><span class="n">GHz</span>

<span class="k">def</span> <span class="nf">get_scan_points</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span>
</pre></div>
</div>
<p>In the above example, a narrow range of 200 kHz is being scanned about a center frequency of 1.8121 GHz.  This
narrow range is displayed in the GUI for editing and each realtive scan point value will have 1.81121 GHz added
to it automatically by the framework before the scan is executed.</p>
</div>
<div class="section" id="id1">
<h2>Auto-tracking<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>When working with models, <code class="code docutils literal notranslate"><span class="pre">_x_offset</span></code> can be determined automatically by the framework from the last
fitted value for a scan.  This is useful because the center value of an absolute scan range may change
over time, such as in the case of atomic transition frequencies.  Using auto-tracking allows the scan to naturally
follow any drifts in the value being fit as it is periodically run.  To use auto-tracking in a scan, first create
a scan model that has the <a class="reference internal" href="../models/settings.html#scan_framework.models.scan_model.ScanModel.main_fit" title="scan_framework.models.scan_model.ScanModel.main_fit"><code class="xref py py-attr docutils literal notranslate"><span class="pre">main_fit</span></code></a>
attribute defined.  Then register the scan model with the <code class="code docutils literal notranslate"><span class="pre">auto_track</span></code> attribute set.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">prepare</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c1"># Fetch the current dataset given by my_model.main_fit</span>
    <span class="c1"># and offset every scan point by this value.</span>
    <span class="n">my_model</span> <span class="o">=</span> <span class="n">MyScanModel</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">register_model</span><span class="p">(</span><span class="n">my_model</span><span class="p">,</span> <span class="n">auto_track</span><span class="o">=</span><span class="s1">&#39;fit&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>When <code class="code docutils literal notranslate"><span class="pre">auto_track='fit'</span></code> or <code class="code docutils literal notranslate"><span class="pre">auto_track'fitresults'</span></code> are set, the framework automatically offsets
the scan points by the main fit of the scan.  If <code class="code docutils literal notranslate"><span class="pre">auto_track='fit'</span></code> is set, the most recently fitted
value of <code class="xref py py-attr docutils literal notranslate"><span class="pre">main_fit</span></code> is fetched from the datasets
(i.e. from a previous run of the scan) and used to offset the scan points, while setting <code class="code docutils literal notranslate"><span class="pre">auto_track='fitresults'</span></code>
causes the fitted value that was just found by the scan to be used (which has not yet been saved to the datasets).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Auto tracking can be disabled entirely in either a <code class="code docutils literal notranslate"><span class="pre">FreqScan</span></code> or a <code class="code docutils literal notranslate"><span class="pre">TimeFreqScan</span></code> by setting
<code class="code docutils literal notranslate"><span class="pre">self.enable_auto_tracking</span> <span class="pre">=</span> <span class="pre">False</span></code> in the scan.</p>
</div>
<p>Setting <code class="code docutils literal notranslate"><span class="pre">auto_track='fitresults'</span></code> is useful in cases where a separate sub-scan is run in the
<code class="code docutils literal notranslate"><span class="pre">measure()</span></code> method of a top-level scan and the value returned by the <code class="code docutils literal notranslate"><span class="pre">measure()</span></code> method is a
parameter that is fit by the sub-scan.</p>
<p>As an example, and a more advanced usage of the scan framework:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scan_framework.scans</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">experiments.scans.tickle_scan</span> <span class="k">as</span> <span class="nn">scan</span>
<span class="kn">from</span> <span class="nn">lib.models.rf_resonator_model</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">scan_framework.models</span> <span class="kn">import</span> <span class="o">*</span>


<span class="k">class</span> <span class="nc">RFResonatorScan</span><span class="p">(</span><span class="n">Scan1D</span><span class="p">,</span> <span class="n">EnvExperiment</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;RF Resonator Scan</span>

<span class="sd">    Scans over RF synth frequencies to find the resonant frequency of the resonator</span>
<span class="sd">    between the RF synthesizer output and the ion trap RF electrodes.</span>

<span class="sd">    A separate tickle scan is performed at each scan point (RF synth frequency) to find the</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># top-level scan is run on the host (sub-scan is run on the core device)</span>
    <span class="n">run_on_core</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>

        <span class="c1"># RF synthesizer device</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rf_synth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_device</span><span class="p">(</span><span class="s1">&#39;rf_synth&#39;</span><span class="p">)</span>

        <span class="c1"># tickle scan</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tickle_scan</span> <span class="o">=</span> <span class="n">scan</span><span class="o">.</span><span class="n">TickleScan</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
           <span class="c1"># don&#39;t save any fitted values since this is just a sub-scan</span>
           <span class="n">fit_options</span><span class="o">=</span><span class="s1">&#39;Fit&#39;</span><span class="p">,</span>
           <span class="c1"># auto-center each sub-scan about the fitted value from the previous scan point</span>
           <span class="n">auto_track</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
           <span class="c1"># don&#39;t display fitted values in the log window of the dashboard</span>
           <span class="n">enable_reporting</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">scan_arguments</span><span class="p">()</span>

        <span class="c1"># range of absolute RF synthesizer frequencies</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setattr_argument</span><span class="p">(</span><span class="s1">&#39;rf_frequencies&#39;</span><span class="p">,</span> <span class="n">Scannable</span><span class="p">(</span>
            <span class="n">default</span><span class="o">=</span><span class="n">RangeScan</span><span class="p">(</span>
                <span class="n">start</span><span class="o">=</span><span class="mf">63.72</span> <span class="o">*</span> <span class="n">MHz</span><span class="p">,</span>
                <span class="n">stop</span><span class="o">=</span><span class="mf">63.74</span> <span class="o">*</span> <span class="n">MHz</span><span class="p">,</span>
                <span class="n">npoints</span><span class="o">=</span><span class="mi">10</span>
            <span class="p">),</span>
            <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;MHz&#39;</span><span class="p">,</span>
            <span class="n">scale</span><span class="o">=</span><span class="mi">1</span> <span class="o">*</span> <span class="n">MHz</span><span class="p">,</span>
            <span class="n">ndecimals</span><span class="o">=</span><span class="mi">4</span>
        <span class="p">),</span> <span class="n">group</span><span class="o">=</span><span class="s1">&#39;Scan Range&#39;</span><span class="p">)</span>

        <span class="c1"># range of relative tickle frequencies</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setattr_argument</span><span class="p">(</span><span class="s1">&#39;frequencies&#39;</span><span class="p">,</span> <span class="n">Scannable</span><span class="p">(</span>
            <span class="n">default</span><span class="o">=</span><span class="n">RangeScan</span><span class="p">(</span>
                <span class="n">start</span><span class="o">=-</span><span class="mf">0.1</span> <span class="o">*</span> <span class="n">MHz</span><span class="p">,</span>
                <span class="n">stop</span><span class="o">=</span><span class="mf">0.1</span> <span class="o">*</span> <span class="n">MHz</span><span class="p">,</span>
                <span class="n">npoints</span><span class="o">=</span><span class="mi">30</span>
            <span class="p">),</span>
            <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;MHz&#39;</span><span class="p">,</span>
            <span class="n">scale</span><span class="o">=</span><span class="mi">1</span> <span class="o">*</span> <span class="n">MHz</span><span class="p">,</span>
            <span class="n">ndecimals</span><span class="o">=</span><span class="mi">4</span>
        <span class="p">),</span> <span class="n">group</span><span class="o">=</span><span class="s1">&#39;Scan Range&#39;</span><span class="p">)</span>

        <span class="c1"># used internally for auto-tracking</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tracking_seeded</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">prepare</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># set the relative scan points of the sub-scan</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tickle_scan</span><span class="o">.</span><span class="n">frequencies</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tickle_scan</span><span class="o">.</span><span class="n">prepare</span><span class="p">()</span>

        <span class="c1"># register the top-level scan model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">RfResonatorScanModel</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">register_model</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">measurement</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># top-level scan points (RF synth frequencies)</span>
    <span class="k">def</span> <span class="nf">get_scan_points</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rf_trap_frequencies</span>

    <span class="k">def</span> <span class="nf">set_scan_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i_point</span><span class="p">,</span> <span class="n">point</span><span class="p">):</span>
        <span class="c1"># set the RF synth frequency</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">break_realtime</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rf_synth</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">measure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rf_trap_frequency</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TInt64</span><span class="p">:</span>
        <span class="c1"># find the secular frequency that results for the current RF frequency driving the resonator</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tickle_scan</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

        <span class="c1"># fit is not available in datasets since tickle fit&#39;s aren&#39;t being saved</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tickle_scan</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">fit_valid</span><span class="p">:</span>
            <span class="c1"># start auto-tracking the last fitted tickle freq once we have a good fit</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tracking_seeded</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tickle_scan</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="o">.</span><span class="n">frequency</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">after_scan_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i_point</span><span class="p">,</span> <span class="n">point</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracking_seeded</span><span class="p">:</span>
            <span class="c1"># center the next sub-scan about the fitted tickle freq for the</span>
            <span class="c1"># current scan point</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tickle_scan</span><span class="o">.</span><span class="n">auto_track</span> <span class="o">=</span> <span class="s1">&#39;fitresults&#39;</span>
</pre></div>
</div>
<p>Each time the sub-scan is run within the top-level scan in the example above, its scan range will be automatically
centered around the value of the fitted tickle frequency from the previous scan point.  This allows the sub-scan
range to stay appropriately centered about the fitted value at each scan point, which changes with each scan
point.  This method avoids having to specify a very large scan range that spans all the relevant frequencies
of the sub-scan.</p>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="core_features.html" class="btn btn-neutral float-left" title="Core scan features" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="time_freq_scans.html" class="btn btn-neutral float-right" title="Time &amp; frequency scans" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright .</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>